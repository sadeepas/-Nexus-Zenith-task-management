<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Zenith | Ultimate OS</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 32 32%22><defs><linearGradient id=%22a%22 x1=%220%25%22 y1=%220%25%22 x2=%22100%25%22 y2=%22100%25%22><stop offset=%220%25%22 stop-color=%22%236366f1%22/><stop offset=%22100%25%22 stop-color=%22%23a855f7%22/></linearGradient></defs><circle cx=%2216%22 cy=%2216%22 r=%2214%22 fill=%22url(%23a)%22 stroke=%22%23ffffff33%22 stroke-width=%221%22/></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Core System Styles --- */
        :root { 
            --glass: rgba(15, 23, 42, 0.70); 
            --border: rgba(255, 255, 255, 0.08); 
            --accent: #6366f1;
        }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: #020617; 
            color: #f8fafc; 
            overflow-x: hidden; 
        }
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* --- Glassmorphism --- */
        .glass { 
            background: var(--glass); 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border); 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); 
        }
        .glass-dark { 
            background: rgba(0, 0, 0, 0.3); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255,255,255,0.05); 
        }
        
        /* --- Dynamic Background --- */
        .mesh-bg {
            position: fixed; inset: 0; z-index: -1;
            background: 
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), 
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%), 
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            background-size: 200% 200%;
            animation: meshMove 20s ease infinite;
        }
        @keyframes meshMove { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

        /* --- Calendar & UI --- */
        .calendar-day { transition: 0.3s; aspect-ratio: 1/1; display: flex; align-items: center; justify-content: center; border-radius: 12px; font-size: 0.75rem; cursor: pointer; }
        .day-active { background: linear-gradient(135deg, #6366f1, #a855f7); color: white; font-weight: 800; box-shadow: 0 0 15px rgba(99, 102, 241, 0.5); border: 1px solid rgba(255,255,255,0.2); }
        
        /* --- Custom Scroll --- */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: rgba(99, 102, 241, 0.3); border-radius: 10px; }
        ::-webkit-scrollbar-track { background: transparent; }

        /* --- Loader Animation --- */
        #loader { position: fixed; inset: 0; background: #020617; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.8s ease-out; }
        .loader-ring { width: 60px; height: 60px; border: 4px solid rgba(99,102,241,0.1); border-top-color: #6366f1; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- Utilities --- */
        .custom-check:checked + span { text-decoration: line-through; color: #64748b; }
        .glow-text { text-shadow: 0 0 20px rgba(99, 102, 241, 0.5); }
    </style>
</head>
<body class="min-h-screen pb-20 selection:bg-indigo-500/30">

    <div id="loader">
        <div class="relative flex items-center justify-center mb-8">
            <div class="loader-ring absolute"></div>
            <div class="w-2 h-2 bg-white rounded-full animate-pulse"></div>
        </div>
        <h1 class="text-5xl font-black tracking-[0.2em] text-white mb-2">NEXUS <span class="text-indigo-500">ZENITH</span></h1>
        <p class="text-[10px] text-slate-500 font-mono uppercase tracking-widest">System Optimization Sequence...</p>
    </div>

    <div class="mesh-bg"></div>

    <div class="max-w-[1600px] mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6 relative z-10">
        
        <aside class="lg:col-span-4 space-y-6">
            
            <div class="glass rounded-[2rem] p-6 flex items-center gap-5 border-t border-white/10">
                <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-indigo-600 to-purple-700 flex items-center justify-center shadow-lg shadow-indigo-500/20">
                    <span class="font-bold text-2xl text-white">Z</span>
                </div>
                <div>
                    <h2 class="font-bold text-xl leading-tight text-white">Nexus Zenith</h2>
                    <div class="flex items-center gap-2 mt-1">
                        <div class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></div>
                        <p class="text-[10px] text-indigo-300 font-mono uppercase tracking-widest" id="clock">00:00:00</p>
                    </div>
                </div>
            </div>

            <div class="glass rounded-[2rem] p-6 space-y-4">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-bold tracking-tight text-lg">Initialize Protocol</h3>
                    <span class="text-[9px] bg-indigo-500/10 text-indigo-400 border border-indigo-500/20 px-2 py-1 rounded font-mono">NEW TASK</span>
                </div>
                
                <div class="space-y-3">
                    <input id="titleIn" type="text" placeholder="Mission Objective" class="w-full glass-dark p-4 rounded-xl outline-none focus:border-indigo-500 focus:bg-white/5 transition-all text-sm placeholder-slate-500 text-white">
                    
                    <div class="grid grid-cols-2 gap-3">
                        <input id="dateIn" type="datetime-local" class="glass-dark p-4 rounded-xl outline-none text-xs text-slate-300 focus:border-indigo-500 transition-all">
                        <select id="priorityIn" class="glass-dark p-4 rounded-xl outline-none text-xs text-slate-300 focus:border-indigo-500 transition-all cursor-pointer">
                            <option value="Normal">Priority: Normal</option>
                            <option value="Critical">Priority: Critical</option>
                        </select>
                    </div>

                    <div class="bg-black/20 p-4 rounded-xl space-y-3 border border-white/5">
                        <label class="text-[10px] font-bold text-indigo-400 uppercase flex items-center gap-2">
                            <span>üìã Tactical Steps</span>
                        </label>
                        <div class="flex gap-2">
                            <input id="subTaskIn" type="text" placeholder="Add step..." class="flex-1 bg-transparent text-xs outline-none text-white placeholder-slate-600 border-b border-white/10 pb-1 focus:border-indigo-500 transition-colors">
                            <button onclick="addTempSub()" class="text-indigo-400 hover:text-white font-bold text-xl leading-none">+</button>
                        </div>
                        <ul id="tempSubList" class="space-y-2 max-h-24 overflow-y-auto"></ul>
                    </div>

                    <textarea id="noteIn" placeholder="Strategic parameters..." class="w-full glass-dark p-4 rounded-xl outline-none h-24 text-sm resize-none focus:border-indigo-500 transition-all placeholder-slate-500 text-slate-300"></textarea>
                    
                    <div class="flex items-center gap-3">
                        <label class="flex-1 glass-dark p-3 rounded-xl text-center text-[10px] font-bold cursor-pointer hover:bg-indigo-500/20 transition-all text-indigo-300 border border-dashed border-indigo-500/30 hover:border-indigo-500">
                            üì∑ UPLOAD INTEL
                            <input type="file" id="mediaIn" class="hidden" onchange="handleFile(this)">
                        </label>
                        <div id="mediaPreview" class="hidden w-10 h-10 rounded-lg overflow-hidden border border-white/20 bg-black"></div>
                    </div>
                </div>
                
                <button onclick="addGoal()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 p-4 rounded-xl font-bold shadow-lg shadow-indigo-500/25 active:scale-95 transition-all flex items-center justify-center gap-2">
                    <span>INITIATE</span>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                </button>
            </div>

            <div class="glass rounded-[2rem] p-6 hidden lg:block">
                <div class="flex justify-between items-center mb-6">
                    <h4 id="calMonth" class="font-bold text-sm uppercase tracking-wider"></h4>
                    <div class="flex gap-1">
                        <button onclick="moveMonth(-1)" class="p-1 hover:bg-white/10 rounded text-slate-400 hover:text-white transition">‚óÄ</button>
                        <button onclick="moveMonth(1)" class="p-1 hover:bg-white/10 rounded text-slate-400 hover:text-white transition">‚ñ∂</button>
                    </div>
                </div>
                <div class="grid grid-cols-7 gap-2 text-center text-[9px] font-black text-slate-500 mb-2">
                    <span>S</span><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span>
                </div>
                <div id="calendarGrid" class="grid grid-cols-7 gap-2"></div>
            </div>

            <div class="glass rounded-[2rem] p-6 space-y-4">
                <h3 class="font-bold tracking-tight text-sm uppercase text-slate-400">System Maintenance</h3>
                
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="backupSystem()" class="group flex flex-col items-center justify-center p-4 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 hover:border-indigo-500/50 transition-all">
                        <span class="text-xl mb-2 group-hover:scale-110 transition-transform">üíæ</span>
                        <span class="text-[10px] font-bold text-slate-300">EXTRACT CORE</span>
                        <span class="text-[8px] text-slate-500">Save Backup</span>
                    </button>

                    <label class="cursor-pointer group flex flex-col items-center justify-center p-4 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 hover:border-emerald-500/50 transition-all">
                        <span class="text-xl mb-2 group-hover:scale-110 transition-transform">‚ôªÔ∏è</span>
                        <span class="text-[10px] font-bold text-slate-300">INJECT DATA</span>
                        <span class="text-[8px] text-slate-500">Restore Backup</span>
                        <input type="file" id="backupInput" class="hidden" accept=".json" onchange="restoreSystem(this)">
                    </label>
                </div>
                <p class="text-[9px] text-slate-600 text-center font-mono">NEXUS SECURE IO PROTOCOL V1.2</p>
            </div>

        </aside>

        <main class="lg:col-span-8 space-y-6">
            <div class="flex flex-col md:flex-row justify-between items-end gap-4 border-b border-white/5 pb-4">
                <div>
                    <h2 class="text-4xl md:text-5xl font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-white via-indigo-200 to-slate-400">MISSION <span class="text-indigo-500 glow-text">CONTROL</span></h2>
                    <p class="text-xs text-slate-400 mt-2 font-mono">Real-time object tracking and analytics v5.1</p>
                </div>
                <div class="flex gap-3">
                    <div class="glass-dark px-5 py-2 rounded-full text-[10px] font-bold border border-emerald-500/20 text-emerald-400 flex items-center gap-2">
                        <span class="w-2 h-2 bg-emerald-500 rounded-full"></span> ACTIVE: <span id="activeCount">0</span>
                    </div>
                    <div class="glass-dark px-5 py-2 rounded-full text-[10px] font-bold border border-slate-500/20 text-slate-400">
                        COMPLETED: <span id="doneCount">0</span>
                    </div>
                </div>
            </div>

            <div id="goalGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-12">
                </div>
        </main>
    </div>

    <div id="shareModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/90 backdrop-blur-md hidden opacity-0 transition-opacity duration-300">
        <div class="glass rounded-[3rem] p-10 max-w-sm w-full text-center relative border border-white/10 shadow-2xl shadow-indigo-500/10">
            <button onclick="toggleElement('shareModal')" class="absolute top-6 right-8 text-slate-500 hover:text-white text-xl">‚úï</button>
            <div class="w-16 h-16 bg-gradient-to-tr from-indigo-500 to-purple-600 rounded-full mx-auto mb-6 flex items-center justify-center text-2xl">üì°</div>
            <h3 class="text-2xl font-black mb-2 text-white">Broadcast Data</h3>
            <p class="text-slate-400 text-xs mb-8">Securely transmit mission parameters.</p>
            <div id="shareIcons" class="grid grid-cols-1 gap-3"></div>
        </div>
    </div>

    <script>
        // --- 1. INITIALIZATION ---
        let goals = JSON.parse(localStorage.getItem("nexus_zenith_v5_goals")) || [];
        let tempMedia = null;
        let tempSubtasks = [];
        let calDate = new Date();

        window.addEventListener('load', () => {
            // Fake loading sequence
            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => { document.getElementById('loader').style.display = 'none'; }, 800);
            }, 1500);
            
            // Start Systems
            render();
            renderCalendar();
            setInterval(livePulse, 1000); // The Heartbeat of the OS
        });

        // --- 2. LIVE PULSE ENGINE ---
        function livePulse() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('en-US', {hour12:false});

            goals.forEach(g => {
                const el = document.getElementById(`card-${g.id}`);
                if(!el) return;

                const diff = g.date - now.getTime();
                const isExpired = diff <= 0;

                const totalDuration = g.date - g.start;
                const timeElapsed = now.getTime() - g.start;
                
                let timePercent = 0;
                if(totalDuration > 0) {
                    timePercent = (timeElapsed / totalDuration) * 100;
                    timePercent = Math.min(100, Math.max(0, timePercent));
                }

                let taskPercent = 0;
                if(g.subtasks.length > 0) {
                    const done = g.subtasks.filter(t => t.done).length;
                    taskPercent = (done / g.subtasks.length) * 100;
                } else {
                    taskPercent = timePercent;
                }

                let finalProg = g.subtasks.length > 0 
                    ? (taskPercent * 0.7) + (timePercent * 0.3)
                    : timePercent;
                
                if (isExpired && g.subtasks.every(t => t.done)) finalProg = 100;

                const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((diff % (1000 * 60)) / 1000);

                const updateTxt = (id, val) => {
                    const node = document.getElementById(id);
                    if(node) node.innerText = val < 0 ? '00' : (val < 10 ? '0'+val : val);
                };

                if(!isExpired) {
                    updateTxt(`t-d-${g.id}`, d);
                    updateTxt(`t-h-${g.id}`, h);
                    updateTxt(`t-m-${g.id}`, m);
                    updateTxt(`t-s-${g.id}`, s);
                } else {
                    ['d','h','m','s'].forEach(u => updateTxt(`t-${u}-${g.id}`, 0));
                    el.classList.add('border-rose-500/30');
                }

                const bar = document.getElementById(`prog-bar-${g.id}`);
                const txt = document.getElementById(`prog-txt-${g.id}`);
                if(bar) bar.style.width = `${finalProg}%`;
                if(txt) txt.innerText = `${Math.floor(finalProg)}%`;
            });
        }

        // --- 3. INPUT HANDLERS ---
        function handleFile(input) {
            const file = input.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                tempMedia = e.target.result;
                const prev = document.getElementById('mediaPreview');
                prev.classList.remove('hidden');
                prev.innerHTML = `<img src="${tempMedia}" class="w-full h-full object-cover">`;
            };
            reader.readAsDataURL(file);
        }

        function addTempSub() {
            const input = document.getElementById('subTaskIn');
            const val = input.value.trim();
            if(val) {
                tempSubtasks.push({ text: val, done: false });
                input.value = "";
                renderTempSubs();
            }
        }

        function renderTempSubs() {
            document.getElementById('tempSubList').innerHTML = tempSubtasks.map((t, i) => 
                `<li class="text-xs text-slate-300 flex justify-between items-center bg-white/5 p-2 rounded-lg border border-white/5 animate-[fadeIn_0.3s_ease]">
                    <span class="truncate pr-2">‚Ä¢ ${t.text}</span>
                    <button onclick="tempSubtasks.splice(${i},1);renderTempSubs()" class="text-red-400 hover:text-red-300 font-bold px-2">√ó</button>
                </li>`
            ).join('');
        }

        // --- 4. CRUD OPERATIONS ---
        function addGoal() {
            const title = document.getElementById('titleIn').value;
            const date = document.getElementById('dateIn').value;
            if(!title || !date) return alert("System Error: Missing Critical Parameters (Title/Date)");

            const newGoal = {
                id: Date.now(),
                title, 
                date: new Date(date).getTime(),
                priority: document.getElementById('priorityIn').value,
                note: document.getElementById('noteIn').value,
                media: tempMedia,
                subtasks: [...tempSubtasks],
                start: Date.now()
            };

            goals.push(newGoal);
            
            tempMedia = null;
            tempSubtasks = [];
            document.getElementById('mediaPreview').classList.add('hidden');
            document.getElementById('titleIn').value = "";
            document.getElementById('noteIn').value = "";
            document.getElementById('subTaskIn').value = "";
            renderTempSubs();

            save(); render(); renderCalendar();
        }

        function toggleTask(goalId, subIndex) {
            const goal = goals.find(g => g.id === goalId);
            if(goal) {
                goal.subtasks[subIndex].done = !goal.subtasks[subIndex].done;
                save(); render(); 
            }
        }

        function deleteGoal(id) {
            if(confirm("‚ö† CONFIRM DELETION: Use of recovery tools will be impossible.")) {
                goals = goals.filter(g => g.id !== id);
                save(); render(); renderCalendar();
            }
        }

        function save() { localStorage.setItem("nexus_zenith_v5_goals", JSON.stringify(goals)); }

        // --- 5. SYSTEM BACKUP & RESTORE ---
        function backupSystem() {
            if(goals.length === 0) return alert("System Empty. No data to extract.");
            const dataStr = JSON.stringify(goals, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const timestamp = new Date().toISOString().slice(0,10);
            a.href = url;
            a.download = `NEXUS_CORE_BACKUP_${timestamp}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function restoreSystem(input) {
            const file = input.files[0];
            if(!file) return;
            if(confirm("‚ö†Ô∏è SYSTEM WARNING: Injecting new data will OVERWRITE all current missions. Proceed?")) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if(!Array.isArray(importedData)) throw new Error("Invalid Data Format");
                        goals = importedData;
                        save();
                        render();
                        renderCalendar();
                        alert("‚úÖ System Restored Successfully.");
                    } catch (err) {
                        alert("‚ùå Error: Corrupted or incompatible backup file.");
                    }
                    input.value = '';
                };
                reader.readAsText(file);
            } else {
                input.value = '';
            }
        }

        // --- 6. RENDER DASHBOARD ---
        function render() {
            const grid = document.getElementById('goalGrid');
            grid.innerHTML = "";
            let active = 0, doneCount = 0;
            const now = Date.now();

            goals.sort((a,b) => a.date - b.date).forEach((g) => {
                const isOver = g.date <= now;
                if(isOver) doneCount++; else active++;

                const subHtml = g.subtasks.map((t, i) => `
                    <label class="flex items-center gap-3 cursor-pointer group p-1.5 hover:bg-white/5 rounded-lg transition-colors border border-transparent hover:border-white/5">
                        <input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleTask(${g.id}, ${i})" 
                            class="custom-check peer appearance-none w-4 h-4 border-2 border-slate-600 rounded bg-transparent checked:bg-indigo-500 checked:border-indigo-500 transition-all relative">
                        <span class="text-[11px] text-slate-300 transition-all select-none peer-checked:text-slate-500">${t.text}</span>
                    </label>
                `).join('');

                grid.innerHTML += `
                    <div id="card-${g.id}" class="glass p-6 rounded-[2.5rem] flex flex-col relative overflow-hidden group border-t border-white/10 transition-all hover:scale-[1.01]">
                        
                        <div class="flex justify-between items-start mb-4 relative z-10">
                            <span class="text-[9px] font-black uppercase tracking-[0.2em] px-3 py-1.5 rounded-full bg-black/40 backdrop-blur border border-white/5 ${g.priority === 'Critical' ? 'text-rose-400 border-rose-500/30' : 'text-indigo-400'}">
                                ${g.priority}
                            </span>
                            
                            <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition-all translate-x-4 group-hover:translate-x-0">
                                <button onclick="downloadImg(${g.id})" title="Capture" class="w-8 h-8 rounded-full bg-white/5 hover:bg-indigo-500 hover:text-white flex items-center justify-center transition-colors">üì∏</button>
                                <button onclick="downloadTxt(${g.id})" title="Report" class="w-8 h-8 rounded-full bg-white/5 hover:bg-indigo-500 hover:text-white flex items-center justify-center transition-colors">üìÑ</button>
                                <button onclick="deleteGoal(${g.id})" class="w-8 h-8 rounded-full bg-rose-500/10 hover:bg-rose-500 text-rose-400 hover:text-white flex items-center justify-center transition-colors">‚úï</button>
                            </div>
                        </div>

                        <div class="relative z-10 mb-6">
                            ${g.media ? `<div class="w-full h-40 rounded-2xl mb-5 overflow-hidden border border-white/10 relative group-hover:shadow-[0_0_30px_rgba(99,102,241,0.3)] transition-all"><img src="${g.media}" class="w-full h-full object-cover"></div>` : ''}
                            
                            <h3 class="text-2xl font-extrabold mb-2 leading-tight">${g.title}</h3>
                            <p class="text-xs text-slate-400 mb-5 leading-relaxed font-light">${g.note || 'No tactical notes provided.'}</p>
                            
                            <div class="grid grid-cols-4 gap-2 mb-6">
                                ${timerBlock(g.id, 'd', 'DAYS')}
                                ${timerBlock(g.id, 'h', 'HRS')}
                                ${timerBlock(g.id, 'm', 'MINS')}
                                ${timerBlock(g.id, 's', 'SECS')}
                            </div>

                            ${g.subtasks.length ? `<div class="bg-black/30 p-4 rounded-xl max-h-40 overflow-y-auto custom-scroll space-y-1 border border-white/5">${subHtml}</div>` : ''}
                        </div>

                        <div class="mt-auto relative z-10 bg-black/20 p-4 -m-6 mt-2 border-t border-white/5 backdrop-blur-sm">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-[10px] font-bold text-indigo-300 tracking-wider">PROTOCOL COMPLETION</span>
                                <span id="prog-txt-${g.id}" class="text-xs font-mono font-bold text-white">0%</span>
                            </div>
                            <div class="w-full bg-slate-800/50 h-2 rounded-full overflow-hidden">
                                <div id="prog-bar-${g.id}" class="bg-gradient-to-r from-indigo-500 via-purple-500 to-emerald-400 h-full w-0 transition-all duration-1000 ease-out shadow-[0_0_15px_rgba(99,102,241,0.6)]"></div>
                            </div>
                            <button onclick="openShareHub(${g.id})" class="w-full mt-3 text-[9px] font-bold text-slate-500 hover:text-white uppercase tracking-widest text-center py-2 hover:bg-white/5 rounded transition-colors">
                                Broadcast Status Signal
                            </button>
                        </div>
                    </div>
                `;
            });

            document.getElementById('activeCount').innerText = active;
            document.getElementById('doneCount').innerText = doneCount;
        }

        function timerBlock(id, unit, label) {
            return `
            <div class="bg-white/5 rounded-xl py-2 flex flex-col items-center border border-white/5">
                <span id="t-${unit}-${id}" class="text-lg md:text-xl font-mono font-bold text-white">00</span>
                <span class="text-[8px] text-slate-500 font-bold tracking-widest">${label}</span>
            </div>`;
        }

        // --- 7. CALENDAR & UTILS ---
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = "";
            const year = calDate.getFullYear();
            const month = calDate.getMonth();
            document.getElementById('calMonth').innerText = new Intl.DateTimeFormat('en-US', {month:'long', year:'numeric'}).format(calDate);

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const todayStr = new Date().toDateString();

            for(let i=0; i<firstDay; i++) grid.innerHTML += `<div></div>`;
            
            for(let d=1; d<=daysInMonth; d++) {
                const dateObj = new Date(year, month, d);
                const dateStr = dateObj.toDateString();
                const hasEvent = goals.some(g => new Date(g.date).toDateString() === dateStr);
                const isToday = dateStr === todayStr;

                let classes = "calendar-day text-slate-400 hover:bg-white/10 hover:text-white";
                if(hasEvent) classes += " day-active";
                if(isToday && !hasEvent) classes += " border border-indigo-500 text-indigo-400";

                grid.innerHTML += `<div class="${classes}">${d}</div>`;
            }
        }
        function moveMonth(dir) { calDate.setMonth(calDate.getMonth() + dir); renderCalendar(); }

        function toggleElement(id) { 
            const el = document.getElementById(id);
            if(el.classList.contains('hidden')) {
                el.classList.remove('hidden');
                setTimeout(() => el.classList.remove('opacity-0'), 10);
            } else {
                el.classList.add('opacity-0');
                setTimeout(() => el.classList.add('hidden'), 300);
            }
        }

        function downloadTxt(id) {
            const g = goals.find(x => x.id === id);
            const content = `MISSION: ${g.title}\nPRIORITY: ${g.priority}\nSTATUS: ${g.date < Date.now() ? 'EXPIRED' : 'ACTIVE'}\n\n${g.note}\n\nTASKS:\n${g.subtasks.map(t=>`[${t.done?'X':' '}] ${t.text}`).join('\n')}`;
            const blob = new Blob([content], { type: "text/plain" });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = `Mission_${g.title}.txt`;
            a.click();
        }

        async function downloadImg(id) {
            const el = document.getElementById(`card-${id}`);
            const btns = el.querySelector('button').parentElement;
            btns.style.display = 'none';
            try {
                const canvas = await html2canvas(el, { backgroundColor: '#0f172a', scale: 2, useCORS: true });
                const a = document.createElement("a");
                a.href = canvas.toDataURL("image/png");
                a.download = `Mission_${id}.png`;
                a.click();
            } catch(e) { alert("Rendering Error"); }
            btns.style.display = 'flex';
        }

        function openShareHub(id) {
            const g = goals.find(x => x.id === id);
            const text = `NEXUS UPDATE: ${g.title} is Active. Deadline: ${new Date(g.date).toLocaleDateString()}.`;
            if (navigator.share) {
                navigator.share({ title: g.title, text: text, url: window.location.href });
            } else {
                const encode = encodeURIComponent;
                const links = [
                    { n: 'WhatsApp', icon: 'üí¨', bg: 'bg-emerald-600', url: `https://wa.me/?text=${encode(text)}` },
                    { n: 'Twitter', icon: 'üê¶', bg: 'bg-sky-500', url: `https://twitter.com/intent/tweet?text=${encode(text)}` },
                    { n: 'Email', icon: '‚úâÔ∏è', bg: 'bg-slate-600', url: `mailto:?subject=${encode(g.title)}&body=${encode(text)}` }
                ];
                document.getElementById('shareIcons').innerHTML = links.map(l => `
                    <a href="${l.url}" target="_blank" class="${l.bg} p-4 rounded-xl text-white font-bold hover:scale-105 transition-transform flex items-center justify-center gap-3 shadow-lg">
                        <span class="text-xl">${l.icon}</span> ${l.n}
                    </a>
                `).join('');
                toggleElement('shareModal');
            }
        }
    </script>
</body>
</html>